<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Document Scanning Demo - AuthenticID</title>
        <!--<link rel="stylesheet" th:href="@{webjars/bootstrap/4.2.1/css/bootstrap.min.css}"/> -->
        <link rel="stylesheet" th:href="@{/css/main.css}"/>
    </head>

    <body>
        <main role="main" class="container">
            <div class="starter-template">
                <!--
                <div class="wrapper" style="width:100%; height:10%;">
                    <label for="PhoneNumber">Phone Number:</label>
                    <span><input name="PhoneNumber" id="PhoneNumber" type="text" th:value="${phoneNo}" /></span>
                    <div class="clearboth"></div>
                </div>

                <div class="btn-individual" style="width:100%; height:10%;" th:style = "${displayQR} ? 'display: none' : 'display: block'">
                    <button onclick='aidVerify();'>Verify</button>
                </div>
                -->
                <div style="width:100%; height:5%;">
                    <p>
                        <h1>Request ID: </h1>
                        <h2 th:text="${reqId}"></h2>
                    </p>
                </div>

                <div style="width:100%; height:5%;">
                    <h2 id="processStatus">Initiated</h2>
                </div>

                <div class="btn-individual" style="width:100%; height:5%;">
                    <button onclick='aidGetStatus();'>Get Status</button>
                </div>

                <div style="width:100%; height:5%;">
                    <h1 th:text="${message}"></h1>
                </div>

                <div style="width:100%; height:100%;">
                    <img id='aidLink'
                         th:src="@{${'/zxing/qrcode/?data='+qrLink}}"
                         alt=""
                         title="Please Scan"
                         width="350"
                         height="350" />
                </div>

                <div class="modal-dialog" role="document">
                    <div class="modal-content p-5">
                        <form method="dialog">
                            <p style="text-align: center">Waiting for user confirmation...</p>
                            <p style="text-align: center"><b id="time">01:00</b></p>
                        </form>
                    </div>
                </div>

            </div>
        </main>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
        <!--<script type="text/javascript" th:src="@{webjars/bootstrap/4.2.1/js/bootstrap.min.js}"></script>-->
        <script type="text/javascript">
            function aidVerify()
            {
                var phoneNo = document.getElementById("PhoneNumber").value;
                alert("phoneNo="+phoneNo);
                location.href = '/authenticid/verify?phone=' + phoneNo;
                //$('#aidLink').attr('src', url);
            }

            var processStatus = $('#processStatus');
            var duration = 60 * 5;

            function aidGetStatus() {
                let reqId = '[[${reqId}]]';
                //alert('aidGetStatus: reqId: '+reqId);
                let url = "/authenticid/aidGetStatus/?reqId="+reqId;
                //alert('aidGetStatus: url: '+url);

                var xhttp=new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    //alert('onreadystatechange: status: '+this.status);
                    if (this.readyState == 4 && this.status == 200) {
                        document.getElementById("processStatus").innerHTML =
                            this.responseText;
                    }
                };
                xhttp.open("GET", url, true);
                xhttp.send();

                //$.ajax({
                //    type : "GET",
                //    url : "/authenticid/aidGetStatus/?reqId"+reqId,
                //    function (data, status) {
                //        alert('aidGetStatus: result: '+data);
                //        processStatus.textContent = data;
                //    },
                //    error : function (status) {
                //        alert('aidGetStatus: error!");
                //        processStatus.textContent = 'error';
                //    }
                //});

                //$.getText("/aidGetStatus/?reqId"+reqId, function(data) {
                //    if (data != null) {
                //        alert('aidGetStatus: result: '+data);
                //        processStatus.textContent = data;
                //    }
                //});
            }


            //$('#home-button').click(function (event) {
            //    location.href = '/';
            //});

            function startTimer(display) {
                var minutes, seconds;
                var thisTimer = setInterval(function () {
                    minutes = parseInt(duration / 60, 10);
                    seconds = parseInt(duration % 60, 10);

                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;

                    display.textContent = minutes + ":" + seconds;
                    if (--duration < 0) {
                        //timer = duration;
                        clearInterval(thisTimer);
                    }

                }, 1000);
            }
            
            window.onload = function () {
               // alert("window.onload ")
                //display = document.querySelector('#time');
                //alert("startTimer")
                //startTimer(display);
                //alert("aidGetStatus")
                //location.href = '/authenticid/aidGetStatus?reqId='+reqId+"&duration="+duration;
            };
        </script>
    </body>
</html>